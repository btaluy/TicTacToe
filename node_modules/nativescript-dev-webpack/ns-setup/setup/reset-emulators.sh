#!/bin/bash

var=$(android -h)

configure_emulators() {
    # Append "hw.gpu.enabled=yes", "hw.lcd.density=240" and "skin.name=480x800" to config.ini file of each emulator
    find ~/.android/avd -type f -name 'config.ini' -exec bash -c 'echo $0 && echo "hw.lcd.density=240" | tee -a $0 && echo "skin.name=480x800" | tee -a $0 && echo "hw.gpu.enabled=yes"  | tee -a $0 && echo "hw.keyboard=no" | tee -a $0 && cat $0' {} \;
    find ~/.android/avd/Emulator-Api19-Default.avd -type f -name 'config.ini' -exec bash -c 'echo $0 && echo "hw.ramSize=1024" | tee -a $0 && cat $0' {} \;
    find ~/.android/avd/Emulator-Api19-Google.avd -type f -name 'config.ini' -exec bash -c 'echo $0 && echo "hw.ramSize=1024" | tee -a $0 && cat $0' {} \;
    find ~/.android/avd/Emulator-Api26-Default.avd -type f -name 'config.ini' -exec bash -c 'echo $0 && echo "hw.gps=yes" | tee -a $0 && cat $0' {} \;
    find ~/.android/avd/Emulator-Api26-Playground.avd -type f -name 'config.ini' -exec bash -c 'echo $0 && echo "hw.gps=yes" | tee -a $0 && echo "hw.mainKeys=no" | tee -a $0 && cat $0' {} \;
}

echo "Cleanup existing emulators!"
rm -rf ~/.android/avd/*

if [[ $var == *"Usage:"* ]]; then
    echo "SDK Tools: Old!"
    echo "We do not longer supprot this! Please update the machine!"
    exit 1
else
    echo "SDK Tools: New!"
    echo "Create Emulators"
    echo no | $ANDROID_HOME/tools/bin/avdmanager create avd -n Emulator-Api17-Default -k "system-images;android-17;default;x86" -b default/x86 -c 320M -f
    echo no | $ANDROID_HOME/tools/bin/avdmanager create avd -n Emulator-Api18-Default -k "system-images;android-18;default;x86" -b default/x86 -c 320M -f
    echo no | $ANDROID_HOME/tools/bin/avdmanager create avd -n Emulator-Api19-Default -k "system-images;android-19;default;x86" -b default/x86 -c 320M -f
    echo no | $ANDROID_HOME/tools/bin/avdmanager create avd -n Emulator-Api19-Google -k "system-images;android-19;google_apis;x86" -b google_apis/x86 -c 320M -f
    echo no | $ANDROID_HOME/tools/bin/avdmanager create avd -n Emulator-Api21-Default -k "system-images;android-21;default;x86" -b default/x86 -c 320M -f
    echo no | $ANDROID_HOME/tools/bin/avdmanager create avd -n Emulator-Api21-Google -k "system-images;android-21;google_apis;x86" -b google_apis/x86 -c 320M -f
    echo no | $ANDROID_HOME/tools/bin/avdmanager create avd -n Emulator-Api22-Default -k "system-images;android-22;default;x86" -b default/x86 -c 320M -f
    echo no | $ANDROID_HOME/tools/bin/avdmanager create avd -n Emulator-Api22-Google -k "system-images;android-22;google_apis;x86" -b google_apis/x86 -c 320M -f
    echo no | $ANDROID_HOME/tools/bin/avdmanager create avd -n Emulator-Api23-Default -k "system-images;android-23;default;x86" -b default/x86 -c 320M -f
    echo no | $ANDROID_HOME/tools/bin/avdmanager create avd -n Emulator-Api24-Default -k "system-images;android-24;default;x86" -b default/x86 -c 320M -f
    echo no | $ANDROID_HOME/tools/bin/avdmanager create avd -n Emulator-Api25-Google -k "system-images;android-25;google_apis;x86" -b google_apis/x86 -c 320M -f
    echo no | $ANDROID_HOME/tools/bin/avdmanager create avd -n Emulator-Api26-Google -k "system-images;android-26;google_apis;x86" -b google_apis/x86 -c 320M -f
    echo no | $ANDROID_HOME/tools/bin/avdmanager create avd -n Emulator-Api26-Playground -k "system-images;android-26;google_apis;x86" -b google_apis/x86 -c 320M -f
    echo no | $ANDROID_HOME/tools/bin/avdmanager create avd -n Emulator-Api27-Google -k "system-images;android-27;google_apis;x86" -b google_apis/x86 -c 320M -f
    echo no | $ANDROID_HOME/tools/bin/avdmanager create avd -n Emulator-ApiP-Google -k "system-images;android-P;google_apis;x86" -b google_apis/x86 -c 320M -f

    configure_emulators
fi
